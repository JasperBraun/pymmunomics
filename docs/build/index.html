

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Clonotype feature frequencies &#8212; pymmunomics 1.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'index';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pymmunomics.helper package" href="pymmunomics.helper.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
    <p class="title logo__title">pymmunomics 1.0.0 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="pymmunomics.helper.html">
                        pymmunomics.helper package
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="pymmunomics.ml.html">
                        pymmunomics.ml package
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="pymmunomics.preprocessing.html">
                        pymmunomics.preprocessing package
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="pymmunomics.sim.html">
                        pymmunomics.sim package
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="pymmunomics.stats.html">
                        pymmunomics.stats package
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="pymmunomics.helper.html">
                        pymmunomics.helper package
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="pymmunomics.ml.html">
                        pymmunomics.ml package
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="pymmunomics.preprocessing.html">
                        pymmunomics.preprocessing package
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="pymmunomics.sim.html">
                        pymmunomics.sim package
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="pymmunomics.stats.html">
                        pymmunomics.stats package
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<div id="searchbox"></div></div>
        <div class="sidebar-primary-item">
<h3><a href="#">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pymmunomics.helper.html">pymmunomics.helper package</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymmunomics.ml.html">pymmunomics.ml package</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymmunomics.preprocessing.html">pymmunomics.preprocessing package</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymmunomics.sim.html">pymmunomics.sim package</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymmunomics.stats.html">pymmunomics.stats package</a></li>
</ul>
</div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article"></div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="pymmunomics.helper.html">pymmunomics.helper package</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymmunomics.ml.html">pymmunomics.ml package</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymmunomics.preprocessing.html">pymmunomics.preprocessing package</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymmunomics.sim.html">pymmunomics.sim package</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymmunomics.stats.html">pymmunomics.stats package</a></li>
</ul>
</div>
<span class="target" id="module-pymmunomics"></span><section id="clonotype-feature-frequencies">
<h1>Clonotype feature frequencies<a class="headerlink" href="#clonotype-feature-frequencies" title="Permalink to this heading">#</a></h1>
<p><a class="reference internal" href="pymmunomics.preprocessing.repertoire.html#pymmunomics.preprocessing.repertoire.count_features" title="pymmunomics.preprocessing.repertoire.count_features"><code class="xref py py-func docutils literal notranslate"><span class="pre">pymmunomics.preprocessing.repertoire.count_features()</span></code></a> coveniently
calculates clonotype feature frequencies (the fractions of immune
repertoire cells that share certain features), such as V/J-gene, or CDR3
length usage frequencies.</p>
<p>In the following example, the frequencies of the different V-genes and
J-genes in the different subject repertoires are calculated:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.preprocessing.repertoire</span> <span class="kn">import</span> <span class="n">count_features</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">repertoire</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;Vgene&quot;</span><span class="p">,</span> <span class="s2">&quot;Jgene&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="c1"># subject1</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV6-6&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV6-6&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ2-5&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="c1"># subject2</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV6-6&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBJ4-2&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV6-6&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV9&quot;</span>  <span class="p">,</span> <span class="s2">&quot;TRBJ4-2&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV9&quot;</span>  <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ4-2&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">count_features</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">repertoire</span><span class="o">=</span><span class="n">repertoire</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">repertoire_groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">clonotype_features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Vgene&quot;</span><span class="p">,</span> <span class="s2">&quot;Jgene&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">    subject feature feature_value  frequency</span>
<span class="go">0  subject1   Jgene       TRBJ2-5   0.200000</span>
<span class="go">1  subject1   Jgene       TRBJ2-7   0.800000</span>
<span class="go">2  subject1   Vgene        TRBV30   0.600000</span>
<span class="go">3  subject1   Vgene       TRBV6-6   0.400000</span>
<span class="go">4  subject2   Jgene       TRBJ2-7   0.500000</span>
<span class="go">5  subject2   Jgene       TRBJ4-2   0.500000</span>
<span class="go">6  subject2   Vgene        TRBV30   0.333333</span>
<span class="go">7  subject2   Vgene       TRBV6-6   0.333333</span>
<span class="go">8  subject2   Vgene         TRBV9   0.333333</span>
</pre></div>
</div>
<p>For each of the two subjects (“subject1”, “subject2”) and for each
chosen clonotype feature (“Vgene” and “Jgene”), the function counts
the rows with the same value for that feature’s column and normalizes
by the total number of rows for that subject.</p>
<p>Some basic variations:</p>
<ul class="simple">
<li><p>Instead of frequencies one can obtain absolute counts or one-hot
encodings via the parameter <cite>stat</cite></p></li>
<li><p>To make sure each subject has counts for the the same feature values
in the resulting table, one can use the parameter
<cite>shared_clonotype_feature_groups</cite></p></li>
<li><p>For partially aggregated input data providing clonotypes and their
counts, the parameter <cite>clonesize</cite> should be used</p></li>
</ul>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.preprocessing.repertoire</span> <span class="kn">import</span> <span class="n">count_features</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">repertoire</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;Vgene&quot;</span><span class="p">,</span> <span class="s2">&quot;Jgene&quot;</span><span class="p">,</span> <span class="s2">&quot;clone_size&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="c1"># subject1</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV6-6&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ2-5&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="c1"># subject2</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV6-6&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBJ4-2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV6-6&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV9&quot;</span>  <span class="p">,</span> <span class="s2">&quot;TRBJ4-2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV9&quot;</span>  <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ4-2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">count_features</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">repertoire</span><span class="o">=</span><span class="n">repertoire</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">repertoire_groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">clonotype_features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Vgene&quot;</span><span class="p">,</span> <span class="s2">&quot;Jgene&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">clonesize</span><span class="o">=</span><span class="s2">&quot;clone_size&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">shared_clonotype_feature_groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">     subject feature feature_value  count</span>
<span class="go">0   subject1   Jgene       TRBJ2-5      1</span>
<span class="go">1   subject1   Jgene       TRBJ2-7      4</span>
<span class="go">2   subject1   Jgene       TRBJ4-2      0</span>
<span class="go">3   subject1   Vgene        TRBV30      3</span>
<span class="go">4   subject1   Vgene       TRBV6-6      2</span>
<span class="go">5   subject1   Vgene         TRBV9      0</span>
<span class="go">6   subject2   Jgene       TRBJ2-5      0</span>
<span class="go">7   subject2   Jgene       TRBJ2-7     30</span>
<span class="go">8   subject2   Jgene       TRBJ4-2      3</span>
<span class="go">9   subject2   Vgene        TRBV30     11</span>
<span class="go">10  subject2   Vgene       TRBV6-6     11</span>
<span class="go">11  subject2   Vgene         TRBV9     11</span>
</pre></div>
</div>
<p>In a more complex experiment, clonotypes may be grouped in different
ways, such as into different cell types and cell subtypes. This can be
achieved via the parameters <cite>repertoire_groups</cite> and
<cite>partial_repertoire_pools</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.preprocessing.repertoire</span> <span class="kn">import</span> <span class="n">count_features</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">repertoire</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cell type&quot;</span><span class="p">,</span> <span class="s2">&quot;cell subtype&quot;</span><span class="p">,</span> <span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;Vgene&quot;</span><span class="p">,</span> <span class="s2">&quot;Jgene&quot;</span><span class="p">,</span> <span class="s2">&quot;clone_size&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="c1"># TRB subject1</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;TRB&quot;</span><span class="p">,</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span> <span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV6-6&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;TRB&quot;</span><span class="p">,</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span> <span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span>  <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;TRB&quot;</span><span class="p">,</span> <span class="s2">&quot;CD8&quot;</span><span class="p">,</span> <span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span>  <span class="p">,</span> <span class="s2">&quot;TRBJ2-5&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="c1"># TRB subject2</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;TRB&quot;</span><span class="p">,</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV6-6&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ4-2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;TRB&quot;</span><span class="p">,</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV6-6&quot;</span> <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;TRB&quot;</span><span class="p">,</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV9&quot;</span>   <span class="p">,</span> <span class="s2">&quot;TRBJ4-2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;TRB&quot;</span><span class="p">,</span> <span class="s2">&quot;CD8&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV9&quot;</span>   <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;TRB&quot;</span><span class="p">,</span> <span class="s2">&quot;CD8&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span>  <span class="p">,</span> <span class="s2">&quot;TRBJ4-2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;TRB&quot;</span><span class="p">,</span> <span class="s2">&quot;CD8&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;TRBV30&quot;</span>  <span class="p">,</span> <span class="s2">&quot;TRBJ2-7&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="gp">... </span>        <span class="c1"># IGH subject1</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;IGH&quot;</span><span class="p">,</span> <span class="s2">&quot;IgG&quot;</span><span class="p">,</span> <span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV3-33&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ2&quot;</span>  <span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;IGH&quot;</span><span class="p">,</span> <span class="s2">&quot;IgM&quot;</span><span class="p">,</span> <span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-18&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ2&quot;</span>  <span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;IGH&quot;</span><span class="p">,</span> <span class="s2">&quot;IgM&quot;</span><span class="p">,</span> <span class="s2">&quot;subject1&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-18&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ5&quot;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="c1"># IGH subject2</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;IGH&quot;</span><span class="p">,</span> <span class="s2">&quot;IgG&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV3-33&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;IGH&quot;</span><span class="p">,</span> <span class="s2">&quot;IgG&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV3-33&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ2&quot;</span>  <span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;IGH&quot;</span><span class="p">,</span> <span class="s2">&quot;IgM&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV4-4&quot;</span> <span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;IGH&quot;</span><span class="p">,</span> <span class="s2">&quot;IgM&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV4-4&quot;</span> <span class="p">,</span> <span class="s2">&quot;IGHJ2&quot;</span>  <span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;IGH&quot;</span><span class="p">,</span> <span class="s2">&quot;IgM&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-18&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;IGH&quot;</span><span class="p">,</span> <span class="s2">&quot;IgM&quot;</span><span class="p">,</span> <span class="s2">&quot;subject2&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-18&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ2&quot;</span>  <span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">count_features</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">repertoire</span><span class="o">=</span><span class="n">repertoire</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">repertoire_groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cell type&quot;</span><span class="p">,</span> <span class="s2">&quot;cell subtype&quot;</span><span class="p">,</span> <span class="s2">&quot;subject&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">clonotype_features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Vgene&quot;</span><span class="p">,</span> <span class="s2">&quot;Jgene&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">clonesize</span><span class="o">=</span><span class="s2">&quot;clone_size&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">partial_repertoire_pools</span><span class="o">=</span><span class="p">[[],</span> <span class="p">[</span><span class="s2">&quot;cell subtype&quot;</span><span class="p">]],</span>
<span class="gp">... </span>    <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">shared_clonotype_feature_groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">   cell type cell subtype   subject feature feature_value  count</span>
<span class="go">0        IGH          IgG  subject1   Jgene         IGHJ2      2</span>
<span class="go">1        IGH          IgG  subject1   Jgene         IGHJ4      0</span>
<span class="go">2        IGH          IgG  subject1   Vgene      IGHV3-33      2</span>
<span class="go">3        IGH          IgG  subject2   Jgene         IGHJ2     10</span>
<span class="go">4        IGH          IgG  subject2   Jgene         IGHJ4      1</span>
<span class="go">5        IGH          IgG  subject2   Vgene      IGHV3-33     11</span>
<span class="go">6        IGH          IgM  subject1   Jgene         IGHJ2      2</span>
<span class="go">7        IGH          IgM  subject1   Jgene         IGHJ4      0</span>
<span class="go">8        IGH          IgM  subject1   Jgene         IGHJ5      1</span>
<span class="go">9        IGH          IgM  subject1   Vgene      IGHV1-18      3</span>
<span class="go">10       IGH          IgM  subject1   Vgene       IGHV4-4      0</span>
<span class="go">11       IGH          IgM  subject2   Jgene         IGHJ2     20</span>
<span class="go">12       IGH          IgM  subject2   Jgene         IGHJ4      2</span>
<span class="go">13       IGH          IgM  subject2   Jgene         IGHJ5      0</span>
<span class="go">14       IGH          IgM  subject2   Vgene      IGHV1-18     11</span>
<span class="go">15       IGH          IgM  subject2   Vgene       IGHV4-4     11</span>
<span class="go">16       IGH       pooled  subject1   Jgene         IGHJ2      4</span>
<span class="go">17       IGH       pooled  subject1   Jgene         IGHJ4      0</span>
<span class="go">18       IGH       pooled  subject1   Jgene         IGHJ5      1</span>
<span class="go">19       IGH       pooled  subject1   Vgene      IGHV1-18      3</span>
<span class="go">20       IGH       pooled  subject1   Vgene      IGHV3-33      2</span>
<span class="go">21       IGH       pooled  subject1   Vgene       IGHV4-4      0</span>
<span class="go">22       IGH       pooled  subject2   Jgene         IGHJ2     30</span>
<span class="go">23       IGH       pooled  subject2   Jgene         IGHJ4      3</span>
<span class="go">24       IGH       pooled  subject2   Jgene         IGHJ5      0</span>
<span class="go">25       IGH       pooled  subject2   Vgene      IGHV1-18     11</span>
<span class="go">26       IGH       pooled  subject2   Vgene      IGHV3-33     11</span>
<span class="go">27       IGH       pooled  subject2   Vgene       IGHV4-4     11</span>
<span class="go">28       TRB          CD4  subject1   Jgene       TRBJ2-7      4</span>
<span class="go">29       TRB          CD4  subject1   Jgene       TRBJ4-2      0</span>
<span class="go">30       TRB          CD4  subject1   Vgene        TRBV30      2</span>
<span class="go">31       TRB          CD4  subject1   Vgene       TRBV6-6      2</span>
<span class="go">32       TRB          CD4  subject1   Vgene         TRBV9      0</span>
<span class="go">33       TRB          CD4  subject2   Jgene       TRBJ2-7     10</span>
<span class="go">34       TRB          CD4  subject2   Jgene       TRBJ4-2      2</span>
<span class="go">35       TRB          CD4  subject2   Vgene        TRBV30      0</span>
<span class="go">36       TRB          CD4  subject2   Vgene       TRBV6-6     11</span>
<span class="go">37       TRB          CD4  subject2   Vgene         TRBV9      1</span>
<span class="go">38       TRB          CD8  subject1   Jgene       TRBJ2-5      1</span>
<span class="go">39       TRB          CD8  subject1   Jgene       TRBJ2-7      0</span>
<span class="go">40       TRB          CD8  subject1   Jgene       TRBJ4-2      0</span>
<span class="go">41       TRB          CD8  subject1   Vgene        TRBV30      1</span>
<span class="go">42       TRB          CD8  subject1   Vgene         TRBV9      0</span>
<span class="go">43       TRB          CD8  subject2   Jgene       TRBJ2-5      0</span>
<span class="go">44       TRB          CD8  subject2   Jgene       TRBJ2-7     20</span>
<span class="go">45       TRB          CD8  subject2   Jgene       TRBJ4-2      1</span>
<span class="go">46       TRB          CD8  subject2   Vgene        TRBV30     11</span>
<span class="go">47       TRB          CD8  subject2   Vgene         TRBV9     10</span>
<span class="go">48       TRB       pooled  subject1   Jgene       TRBJ2-5      1</span>
<span class="go">49       TRB       pooled  subject1   Jgene       TRBJ2-7      4</span>
<span class="go">50       TRB       pooled  subject1   Jgene       TRBJ4-2      0</span>
<span class="go">51       TRB       pooled  subject1   Vgene        TRBV30      3</span>
<span class="go">52       TRB       pooled  subject1   Vgene       TRBV6-6      2</span>
<span class="go">53       TRB       pooled  subject1   Vgene         TRBV9      0</span>
<span class="go">54       TRB       pooled  subject2   Jgene       TRBJ2-5      0</span>
<span class="go">55       TRB       pooled  subject2   Jgene       TRBJ2-7     30</span>
<span class="go">56       TRB       pooled  subject2   Jgene       TRBJ4-2      3</span>
<span class="go">57       TRB       pooled  subject2   Vgene        TRBV30     11</span>
<span class="go">58       TRB       pooled  subject2   Vgene       TRBV6-6     11</span>
<span class="go">59       TRB       pooled  subject2   Vgene         TRBV9     11</span>
</pre></div>
</div>
<p>The partial pooling achieved one round of counts grouped by all of the
grouping variables <cite>[“cell type”, “cell subtype”, “subject”]</cite> which can
be thought of as partially pooled by columns <cite>[]</cite> (the first item in the
argument of <cite>partial_repertoire_pools</cite>) and one round of counts where
clonotypes from different subtypes are pooled together (corresponding to
the second item in the argument <cite>[“cell subtype”]</cite>
<cite>partial_repertoire_pools</cite>)</p>
</section>
<section id="cdr3-length-comparison">
<h1>CDR3 length comparison<a class="headerlink" href="#cdr3-length-comparison" title="Permalink to this heading">#</a></h1>
<p><cite>pymmunomics</cite> implements a statistical test meant for the comparison of
CDR3 length distributions between groups. Given the frequency of each
CDR3 length in the repertoire of each subject in two groups, such as
cases and controls, this test uses a two-tailed Mann-Whitney-U to
compare the cumulatives up to a certain point. This point is chosen to
be at a CDR3 length at which the shift is the most pronounced.</p>
<p>The function <a class="reference internal" href="pymmunomics.stats.compare_cumulatives.html#pymmunomics.stats.compare_cumulatives.compare_best_slope_separator_cumulatives" title="pymmunomics.stats.compare_cumulatives.compare_best_slope_separator_cumulatives"><code class="xref py py-func docutils literal notranslate"><span class="pre">pymmunomics.stats.compare_cumulatives.compare_best_slope_separator_cumulatives()</span></code></a>
implements this test. In the following example, frequencies for CDR3
lengths 1 through 6 for 6 individuals are stored in two arrays <cite>a</cite> and
<cite>b</cite>, with 3 individuals per group.  Note that the frequencies do not
actually add up to 1 in this example, nor is a CDR3 length range of 1-6
realistic.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.stats.compare_cumulatives</span> <span class="kn">import</span> <span class="n">compare_best_slope_separator_cumulatives</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">compare_best_slope_separator_cumulatives</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pvalue: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cumulatives: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">cumulatives</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;slopes: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">slopes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;best_separator_pos: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">best_separator_pos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">pvalue: 0.1</span>
<span class="go">cumulatives: (array([1.5, 1.8, 2.1]), array([0.6, 0.9, 1.2]))</span>
<span class="go">slopes: [-0.3 -0.3 -0.3  0.3  0.3  0.3]</span>
<span class="go">best_separator_pos: 3</span>
</pre></div>
</div>
<p>In addition to the <cite>.pvalue</cite>, the resulting object returns the
<cite>.cumulatives</cite>, which are the values of the cumulatives of each of the
input rows up to the point at which it determined the cumulatives are
best compared. This point is determined with the help of the <cite>.slopes</cite>.
These are medians of the differences of values in <cite>b</cite> minus values in
<cite>a</cite> per column. The <cite>.best_separator_pos</cite> is the index of the column up
to which the cumulatives are compared. This is determined via choosing
the column <cite>i</cite> which maximizes <cite>abs(sum(slopes[:i])) + abs(sum(slopes[i:]))</cite>.</p>
<p>The function allows for specification of a different statistical test
then the default two-tailed Mann-Whitney-U test. For that purpose, its
<cite>test_func</cite> parameter accepts a callable that takes two arrays (the
cumulatives) and returns a p-value. In the next example, a one-sided
Mann-Whitney-U is used.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.stats.compare_cumulatives</span> <span class="kn">import</span> <span class="n">compare_best_slope_separator_cumulatives</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">mannwhitneyu</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;greater&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pvalue</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">compare_best_slope_separator_cumulatives</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">test_func</span><span class="o">=</span><span class="n">test_func</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pvalue: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cumulatives: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">cumulatives</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;slopes: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">slopes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;best_separator_pos: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">best_separator_pos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">pvalue: 0.05</span>
<span class="go">cumulatives: (array([1.5, 1.8, 2.1]), array([0.6, 0.9, 1.2]))</span>
<span class="go">slopes: [-0.3 -0.3 -0.3  0.3  0.3  0.3]</span>
<span class="go">best_separator_pos: 3</span>
</pre></div>
</div>
<p>By default, the slopes are the column-wise median differences from
observations in <cite>b</cite> minus observations in <cite>a</cite>. The parameter <cite>slope</cite> can
be used to specify a custom array of slopes or a custom function which
calculates the slopes. A function would have to take two arrays (columns
from inputs <cite>a</cite> and <cite>b</cite>) and return a value that is then used as the
slope. In the next example, the slopes are determined to be the
difference between the first item in a column of <cite>b</cite> minus the third
item in a column of <cite>a</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.stats.compare_cumulatives</span> <span class="kn">import</span> <span class="n">compare_best_slope_separator_cumulatives</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">slope</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">compare_best_slope_separator_cumulatives</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">slope</span><span class="o">=</span><span class="n">slope</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pvalue: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cumulatives: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">cumulatives</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;slopes: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">slopes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;best_separator_pos: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">best_separator_pos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">pvalue: 0.1</span>
<span class="go">cumulatives: (array([1.5, 1.8, 2.1]), array([0.6, 0.9, 1.2]))</span>
<span class="go">slopes: [-0.5 -0.5 -0.5  0.1  0.1  0.1]</span>
<span class="go">best_separator_pos: 3</span>
</pre></div>
</div>
<p>In this example, an array of slopes is forced by passing the array as
argument to the parameter <cite>slope</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.stats.compare_cumulatives</span> <span class="kn">import</span> <span class="n">compare_best_slope_separator_cumulatives</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">compare_best_slope_separator_cumulatives</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">slope</span><span class="o">=</span><span class="n">slope</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pvalue: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cumulatives: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">cumulatives</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;slopes: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">slopes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;best_separator_pos: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">best_separator_pos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">pvalue: 0.1</span>
<span class="go">cumulatives: (array([0.9, 1.1, 1.3]), array([0.3, 0.5, 0.7]))</span>
<span class="go">slopes: [-0.3 -0.2  0.1  0.2  0.3  0.4]</span>
<span class="go">best_separator_pos: 2</span>
</pre></div>
</div>
</section>
<section id="binding-capacity">
<h1>Binding capacity<a class="headerlink" href="#binding-capacity" title="Permalink to this heading">#</a></h1>
<p><cite>pymmunomics</cite> faciliates the calculation of binding similarities between
pairs of clonotypes.</p>
<p>The binding similarity of a pair of clonotypes is 0
when V- or J-genes disagree and otherwise a function of the Levenshtein
distance between the two CDR3 sequences. The exact function was
determined experimentally to be <cite>0.3 ** Levenshtein_distance</cite>. To
calculate binding similarity, use
<a class="reference internal" href="pymmunomics.sim.similarity.html#pymmunomics.sim.similarity.binding_similarity" title="pymmunomics.sim.similarity.binding_similarity"><code class="xref py py-func docutils literal notranslate"><span class="pre">pymmunomics.sim.similarity.binding_similarity()</span></code></a>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.sim.similarity</span> <span class="kn">import</span> <span class="n">binding_similarity</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CARDYW&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s2">&quot;CARWWWDYW&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span><span class="p">),</span> <span class="c1"># same V-/J-genes: similarity == levenshtein(CARDYW, CARWWWDYW)</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s2">&quot;CARWWWDYW&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-46&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span><span class="p">),</span> <span class="c1"># different V-genes: similarity == 0</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s2">&quot;CARWWWDYW&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ2&quot;</span><span class="p">),</span> <span class="c1"># different J-genes: similarity == 0</span>
<span class="gp">... </span>    <span class="n">left</span><span class="p">,</span> <span class="c1"># same clonotype: similarity == 1</span>
<span class="gp">... </span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">binding_similarity</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">))</span>
<span class="go">0.026999999999999996</span>
<span class="go">0.0</span>
<span class="go">0.0</span>
<span class="go">1.0</span>
</pre></div>
</div>
<p>The input types for the two clonotypes can be any that allows for random
access and contains CDR3 sequence, V-gene, and J-gene at coordinates 0,
1, and 2, respectively.</p>
<p>Average similarity between a query set of clonotypes and a repertoire of
clonotypes (a repertoire being a set of clonotypes with frequencies) can
be measured via the <cite>weighted_similarities</cite> method of any of the classes
<cite>SimilarityFromDataFrame</cite>, <cite>SimilarityFromArray</cite>, <cite>SimilarityFromFile</cite>,
<cite>SimilarityFromFunction</cite> in <a class="reference internal" href="pymmunomics.sim.similarity.html#module-pymmunomics.sim.similarity" title="pymmunomics.sim.similarity"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pymmunomics.sim.similarity</span></code></a>.
The choice of class is driven by the way similarities are calculated,
with each class either relying on a precalculated similarity matrix
stored in a pandas.DataFrame, a numpy.ndarray, or in a file, or
calculating similarities on the fly from a python function.
<a class="reference internal" href="pymmunomics.sim.similarity.html#pymmunomics.sim.similarity.make_similarity" title="pymmunomics.sim.similarity.make_similarity"><code class="xref py py-func docutils literal notranslate"><span class="pre">pymmunomics.sim.similarity.make_similarity()</span></code></a> can be used to
conveninently create the right object for calculating average
similarities.</p>
<p>To calculate binding capacities without precomputed similarity matrix,
<a class="reference internal" href="pymmunomics.sim.similarity.html#pymmunomics.sim.similarity.SimilarityFromFunction" title="pymmunomics.sim.similarity.SimilarityFromFunction"><code class="xref py py-func docutils literal notranslate"><span class="pre">pymmunomics.sim.similarity.SimilarityFromFunction()</span></code></a> can be used
with <a class="reference internal" href="pymmunomics.sim.similarity.html#pymmunomics.sim.similarity.binding_similarity" title="pymmunomics.sim.similarity.binding_similarity"><code class="xref py py-func docutils literal notranslate"><span class="pre">pymmunomics.sim.similarity.binding_similarity()</span></code></a> as its
similarity function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.sim.similarity</span> <span class="kn">import</span> <span class="n">binding_similarity</span><span class="p">,</span> <span class="n">make_similarity</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.helper.log</span> <span class="kn">import</span> <span class="n">set_log_level</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">set_log_level</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span> <span class="c1"># avoid some log statements from being printed</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">repertoire</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cdr3_aa&quot;</span><span class="p">,</span> <span class="s2">&quot;v_gene&quot;</span><span class="p">,</span> <span class="s2">&quot;j_gene&quot;</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;CARDYW&quot;</span>   <span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;CARWDYW&quot;</span>  <span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;CARWWDYW&quot;</span> <span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;CARWWWDYW&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;CARWWWDFW&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ2&quot;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query_clonotypes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cdr3_aa&quot;</span><span class="p">,</span> <span class="s2">&quot;v_gene&quot;</span><span class="p">,</span> <span class="s2">&quot;j_gene&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;CARDYW&quot;</span>   <span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span> <span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span><span class="p">],</span> <span class="c1"># matches first 4 repertoire clonotypes</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;CARWWWDYW&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span> <span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span><span class="p">],</span> <span class="c1"># matches first 4 repertoire clonotypes</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;CARDFW&quot;</span>   <span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span> <span class="p">,</span> <span class="s2">&quot;IGHJ2&quot;</span><span class="p">],</span> <span class="c1"># matches 5th repertoire clonotype</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;CARDYW&quot;</span>   <span class="p">,</span> <span class="s2">&quot;IGHV1-46&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHJ4&quot;</span><span class="p">],</span> <span class="c1"># no match due to V-gene</span>
<span class="gp">... </span>        <span class="p">[</span><span class="s2">&quot;CARDYW&quot;</span>   <span class="p">,</span> <span class="s2">&quot;IGHV1-3&quot;</span> <span class="p">,</span> <span class="s2">&quot;IGHJ3&quot;</span><span class="p">],</span> <span class="c1"># no match due to J-gene</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span> <span class="o">=</span> <span class="n">make_similarity</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">similarity</span><span class="o">=</span><span class="n">binding_similarity</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">X</span><span class="o">=</span><span class="n">query_clonotypes</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">Y</span><span class="o">=</span><span class="n">repertoire</span><span class="p">[[</span><span class="s2">&quot;cdr3_aa&quot;</span><span class="p">,</span> <span class="s2">&quot;v_gene&quot;</span><span class="p">,</span> <span class="s2">&quot;j_gene&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="o">.</span><span class="n">weighted_similarities</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">species_frequencies</span><span class="o">=</span><span class="n">repertoire</span><span class="p">[[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">array([[0.1924],</span>
<span class="go">       [0.3107],</span>
<span class="go">       [0.0054],</span>
<span class="go">       [0.    ],</span>
<span class="go">       [0.    ]])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>the <a class="reference internal" href="pymmunomics.sim.similarity.html#pymmunomics.sim.similarity.SimilarityFromFunction.weighted_similarities" title="pymmunomics.sim.similarity.SimilarityFromFunction.weighted_similarities"><code class="xref py py-func docutils literal notranslate"><span class="pre">pymmunomics.sim.similarity.SimilarityFromFunction.weighted_similarities()</span></code></a>
is parallelized</p></li>
<li><p>the argument <cite>similarities_out</cite> for <a class="reference internal" href="pymmunomics.sim.similarity.html#pymmunomics.sim.similarity.make_similarity" title="pymmunomics.sim.similarity.make_similarity"><code class="xref py py-func docutils literal notranslate"><span class="pre">pymmunomics.sim.similarity.make_similarity()</span></code></a>
can be used to store the calculated similarities in a numpy.ndarray-like
structure</p></li>
<li><p>the argument <cite>chunk_size</cite> for <a class="reference internal" href="pymmunomics.sim.similarity.html#pymmunomics.sim.similarity.make_similarity" title="pymmunomics.sim.similarity.make_similarity"><code class="xref py py-func docutils literal notranslate"><span class="pre">pymmunomics.sim.similarity.make_similarity()</span></code></a>
can be tuned to accelerate computation</p></li>
<li><p>If the argument <cite>Y</cite> for <a class="reference internal" href="pymmunomics.sim.similarity.html#pymmunomics.sim.similarity.make_similarity" title="pymmunomics.sim.similarity.make_similarity"><code class="xref py py-func docutils literal notranslate"><span class="pre">pymmunomics.sim.similarity.make_similarity()</span></code></a>
is None, similarities are calculated between all pairs of clonotypes
in <cite>X</cite></p></li>
</ul>
</section>
<section id="feature-selection">
<h1>Feature selection<a class="headerlink" href="#feature-selection" title="Permalink to this heading">#</a></h1>
<p><cite>pymmunomics</cite> offers a number of related feature selection mechanisms
that are designed to integrate well with the scikit-learn API by
inheriting from sklearn.base.TransformerMixin.</p>
<p>The underlying philosophy of these feature selection mechanisms is that
domain knowledge should be preferred over generic feature selection
mechanisms. To that end, the algorithms implemented by <cite>pymmunomics</cite>
require a scoring function for features and access to a set of
feature measurements whose score represent a background or null
distribution against which to compare the scores of features from which
we select.</p>
<p>For example, non-productively recombined germline receptor sequence
repertoires are often used as a null model for signals in the
productively recombined receptor sequence repertoires arising from
disease-specific selection. Measuring correlation of V-gene frequencies
with the response variable of interest would be a way of scoring V-gene
frequency features.</p>
<p><a class="reference internal" href="pymmunomics.ml.feature_selection.html#pymmunomics.ml.feature_selection.SelectPairedNullScoreOutlier" title="pymmunomics.ml.feature_selection.SelectPairedNullScoreOutlier"><code class="xref py py-class docutils literal notranslate"><span class="pre">pymmunomics.ml.feature_selection.SelectPairedNullScoreOutlier</span></code></a>
selects features in this manner when the null features are paired
measurements to the features from which we select. More precisely, the
mechanism calculates scores (by default Kendall-Tau C correlation
coefficient) from the features together with the response variable.
Outliers in the spread of differences of train-data scores minus
null-data scores indicate which features should be selected.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.helper.log</span> <span class="kn">import</span> <span class="n">set_log_level</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymmunomics.ml.feature_selection</span> <span class="kn">import</span> <span class="n">SelectPairedNullScoreOutlier</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">set_log_level</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span> <span class="c1"># avoid some log statements from being printed</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">train_X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;IGHV1-18&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV3-7&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV3-11&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV3-30&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV4-4&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV4-34&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;case1&quot;</span><span class="p">,</span> <span class="s2">&quot;case2&quot;</span><span class="p">,</span> <span class="s2">&quot;case3&quot;</span><span class="p">,</span> <span class="s2">&quot;case4&quot;</span><span class="p">,</span> <span class="s2">&quot;case5&quot;</span><span class="p">,</span> <span class="s2">&quot;control6&quot;</span><span class="p">,</span> <span class="s2">&quot;control7&quot;</span><span class="p">,</span> <span class="s2">&quot;control8&quot;</span><span class="p">,</span> <span class="s2">&quot;control9&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">train_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">null_X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;IGHV1-18&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV3-7&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV3-11&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV3-30&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV4-4&quot;</span><span class="p">,</span> <span class="s2">&quot;IGHV4-34&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;case1&quot;</span><span class="p">,</span> <span class="s2">&quot;case2&quot;</span><span class="p">,</span> <span class="s2">&quot;case3&quot;</span><span class="p">,</span> <span class="s2">&quot;case4&quot;</span><span class="p">,</span> <span class="s2">&quot;case5&quot;</span><span class="p">,</span> <span class="s2">&quot;control6&quot;</span><span class="p">,</span> <span class="s2">&quot;control7&quot;</span><span class="p">,</span> <span class="s2">&quot;control8&quot;</span><span class="p">,</span> <span class="s2">&quot;control9&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">[</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">null_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">selector</span> <span class="o">=</span> <span class="n">SelectPairedNullScoreOutlier</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">null_X</span><span class="o">=</span><span class="n">null_X</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">null_y</span><span class="o">=</span><span class="n">null_y</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="c1"># select everything with score </span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;train_scores - null_scores: </span><span class="si">{</span><span class="n">selector</span><span class="o">.</span><span class="n">train_scores</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">selector</span><span class="o">.</span><span class="n">null_scores</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lower and upper quantiles: </span><span class="si">{</span><span class="n">selector</span><span class="o">.</span><span class="n">lower_quantile</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">selector</span><span class="o">.</span><span class="n">upper_quantile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;selected columns: </span><span class="si">{</span><span class="n">selector</span><span class="o">.</span><span class="n">selected_columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">selector</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_X</span><span class="p">)</span>
<span class="go">train_scores - null_scores: [ 0.33950617  0.45061728  0.28230453  0.49382716  0.43004115 -0.72839506]</span>
<span class="go">lower and upper quantiles: 0.23176954732510288, 0.4527777777777777</span>
<span class="go">selected columns: Index([&#39;IGHV3-30&#39;, &#39;IGHV4-34&#39;], dtype=&#39;object&#39;)</span>
<span class="go">          IGHV3-30  IGHV4-34</span>
<span class="go">case1         0.20      0.10</span>
<span class="go">case2         0.20      0.11</span>
<span class="go">case3         0.22      0.09</span>
<span class="go">case4         0.19      0.10</span>
<span class="go">case5         0.21      0.10</span>
<span class="go">control6      0.19      0.19</span>
<span class="go">control7      0.17      0.20</span>
<span class="go">control8      0.19      0.20</span>
<span class="go">control9      0.21      0.20</span>
</pre></div>
</div>
<p>The data from which to calculate train scores can also be given in the
initializer of the object using the parameters <cite>train_X</cite> and <cite>train_y</cite>,
which can be helpful for example when a continuous variable is used
during scoring and its binned values are used during actual training and
classificiation of the model.</p>
<p><a class="reference internal" href="pymmunomics.ml.feature_selection.html#pymmunomics.ml.feature_selection.SelectNullScoreOutlier" title="pymmunomics.ml.feature_selection.SelectNullScoreOutlier"><code class="xref py py-class docutils literal notranslate"><span class="pre">pymmunomics.ml.feature_selection.SelectNullScoreOutlier</span></code></a> is
meant to select features when the null features are not paired
measurements. In this mechanism, scores are calculated from all features
(train and null) together with the response variable. train features
whose score falls outside the desired quantiles of the null feature
scores are selected.</p>
</section>


                </article>
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Clonotype feature frequencies</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cdr3-length-comparison">CDR3 length comparison</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#binding-capacity">Binding capacity</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">Feature selection</a></li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="_sources/index.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2022, Jasper Braun.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>